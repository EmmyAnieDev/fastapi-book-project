# **FastAPI Book Management API with CI/CD and Nginx**

## **Overview**

This project is a RESTful API built with FastAPI for managing a book collection. It provides comprehensive CRUD (Create, Read, Update, Delete) operations for books with proper error handling, input validation, and documentation. It also includes a Continuous Integration (CI) and Continuous Deployment (CD) pipeline and is served using Nginx as a reverse proxy, hosted on an AWS EC2 instance.

## **Features**

- ğŸ“š **Book Management (CRUD operations)**
- âœ… **Input validation using Pydantic models**
- ğŸ” **Enum-based genre classification**
- ğŸ§ª **Complete test coverage**
- ğŸ“ **API documentation (auto-generated by FastAPI)**
- ğŸ”’ **CORS middleware enabled**
- ğŸŒ **Deployed on AWS**
- ğŸš€ **CI/CD pipeline for automated testing and deployment**
- ğŸ”€ **Nginx reverse proxy for API handling**

## **Project Structure**

```
fastapi-book-project/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ schemas.py      # Data models and in-memory database
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ books.py        # Book route handlers
â”‚   â””â”€â”€ router.py           # API router configuration
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ config.py           # Application settings
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_books.py       # API endpoint tests
â”œâ”€â”€ main.py                 # Application entry point
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ fastapi.conf        # Nginx configuration file
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ test.yml            # CI pipeline configuration
â”‚   â”œâ”€â”€ deploy.yml          # CD pipeline configuration
â”œâ”€â”€ requirements.txt        # Project dependencies
â””â”€â”€ README.md
```

## **Technologies Used**

- **Python 3.12**
- **FastAPI**
- **Pydantic**
- **pytest**
- **uvicorn**
- **Nginx**
- **AWS EC2 (Hosting the API)**
- **GitHub Actions (CI/CD)**

---

## **Installation**

1. **Clone the repository:**

   ```bash
   git clone https://github.com/hng12-devbotops/fastapi-book-project.git
   cd fastapi-book-project
   ```

2. **Create a virtual environment:**

   ```bash
   python -m venv venv
   source venv/bin/activate # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

---

## **Running the Application**

1. **Start the server:**

   ```bash
   uvicorn main:app --host 0.0.0.0 --port 8000
   ```

2. **Access the API documentation:**
   - Swagger UI: [http://localhost:8000/docs](http://localhost:8000/docs)
   - ReDoc: [http://localhost:8000/redoc](http://localhost:8000/redoc)

---

## **API Endpoints**

### **Books**

- `GET /api/v1/books/` - Get all books
- `GET /api/v1/books/{book_id}` - Get a specific book
- `POST /api/v1/books/` - Create a new book
- `PUT /api/v1/books/{book_id}` - Update a book
- `DELETE /api/v1/books/{book_id}` - Delete a book

### **Health Check**

- `GET /healthcheck` - Check API status

---

## **Book Schema**

```json
{
  "id": 1,
  "title": "Book Title",
  "author": "Author Name",
  "publication_year": 2024,
  "genre": "Fantasy"
}
```

### **Available Genres**

- Science Fiction
- Fantasy
- Horror
- Mystery
- Romance
- Thriller

---

## **Running Tests**

```bash
pytest
```

---

## **Nginx Configuration**

The application is served using Nginx as a reverse proxy. Below is the configuration file (`nginx/fastapi.conf`):

```
server {
listen 80;
server_name YOUR_PUBLIC_IP;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

}
```

### **Applying Nginx Configuration**

```bash
sudo cp nginx/fastapi.conf /etc/nginx/conf.d/
sudo systemctl restart nginx
```

---

## **CI/CD Pipeline**

The CI/CD pipeline is configured inside the `.github/workflows/` directory:

- **CI Pipeline (\`.github/workflows/test.yml\`)**
  Runs tests on pull requests before merging.

- **CD Pipeline (\`.github/workflows/deploy.yml\`)**
  Automatically deploys the latest code to AWS when changes are merged into `main`.

### **Setting Up GitHub Secrets for Deployment**

Before the CD pipeline can deploy updates to AWS, add the following secrets to your GitHub repository:

1. **AWS_HOST** - Public IP of your AWS EC2 instance
2. **AWS_USER** - SSH username (usually `ec2-user`)
3. **AWS_PRIVATE_KEY** - Private key from your AWS `.pem` file

---

## **Deployment to AWS**

### **Setting Up AWS EC2 Server**

1. **Launch an EC2 instance with Amazon Linux 2023.**
2. **Allow required ports in security groups:**
   - Port `22` for SSH
   - Port `80` for HTTP
   - Port `443` for HTTPS
3. **Connect to the instance:**
   ```bash
   ssh -i "your-key.pem" ec2-user@your-public-ip
   ```
4. **Install dependencies:**
   ```bash
   sudo yum update -y
   sudo yum install git nginx python3 python3-venv -y
   ```
5. **Clone your project:**
   ```bash
   cd /home/ec2-user
   git clone https://github.com/YOUR_GITHUB_USERNAME/fastapi-book-project.git fastapi-app
   cd fastapi-app
   python3 -m venv fastapi-env
   source fastapi-env/bin/activate
   pip install -r requirements.txt
   ```
6. **Configure & Restart Services:**
   ```bash
   sudo systemctl restart nginx
   sudo systemctl restart fastapi
   ```

---

## **Deployed API and Documentation**

- ğŸ“Œ **API Base URL:** [http://13.53.131.200/](http://13.53.131.200/)
- ğŸ“‘ **Swagger Documentation:** [http://13.53.131.200/docs#/](http://13.53.131.200/docs#/)

---

## **Error Handling**

The API includes proper error handling for:

1. **Non-existent books**
2. **Invalid book IDs**
3. **Invalid genre types**
4. **Malformed requests**

---

## **Contributing**

1. **Fork the repository**
2. **Create a feature branch (`git checkout -b feature/AmazingFeature`)**
3. **Commit changes (`git commit -m 'Add AmazingFeature'`)**
4. **Push to branch (`git push origin feature/AmazingFeature`)**
5. **Open a Pull Request**

---

## **License**

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

## **Support**

For support, please open an issue in the GitHub repository.
EOF
